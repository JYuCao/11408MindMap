# 数据链路层
## 介质访问控制（MAC）
### 概述
- 主要任务：为使用介质的每个节点隔离来自同一信道上其他节点传送的信号
- MAC方法：信道划分（静态）；随机访问、轮询访问（动态）

### 静态信道划分
#### 时分复用（TDM）
- 将时间划分为多个时隙（TDM帧），每个节点在其分配的时隙内发送数据
- 统计时分复用（STDM）：又称异步时分复用，根据节点的实际使用情况动态分配时隙
#### 频分复用（FDM）
- 将频带划分为多个子信道，每个节点使用一个子信道进行通信
- 为防止信道间干扰，子信道之间需留有“隔离频带”
- 优点：充分利用传输介质的频带资源，系统效率高，实现较为容易
#### 波分复用（WDM）：即光的频分复用
#### 码分复用（CDM/CDMA）
- 原理
    - 将每个比特时间再划分为m个短的时间槽，称为码片（chip）
    - 每个站点分配一个唯一的m位码序列，发送1时发送该码序列，
    发送0时发送该码序列的反码，当多个站点同时发送时，各路数据在信道中线性相加
    - 不同码序列相互正交
- 计算：规格化内积

### 随机访问介质访问控制
#### 概述
- 又称争用型协议
- 总线型网络中，两个或多个用户同时发送信息时，会发生碰撞
- 实质：将广播信道转换为点对点信道

#### 纯ALOHA协议
- 站点需要发送数据时，可以**不进行任何检测**就发送数据，如果一段时间未收到确认，则**随机时间**后进行重传

#### 时隙ALOHA协议
- 同步各站点的时间，将时间划分为多个等长时隙（Slot）
- 规定每个站点只能在时隙开始时发送数据，帧长度必须小于等于时隙长度
- 帧到达后，需要缓存中等待一段小于时隙长度的时间，才能发送
- 重传策略和纯ALOHA类似

#### 载波监听多路访问（CSMA）
- 1-坚持CSMA：站点在发送数据前，先监听信道，若信道空闲则发送，
否则一直监听直到信道空闲后立即发送（立即发送的概率为1）
- 非坚持CSMA：站点在发送数据前，先监听信道，若信道空闲则发送，
否则等待一个随机时间后重新监听信道
- p-坚持CSMA：站点在发送数据前，先监听信道，若信道空闲则以概率p发送，
否则以概率1-p等待一个随机时间后重新监听信道

### 载波监听多路访问/碰撞检测（CSMA/CD）
#### 概述
- 适用于总线型网络或半双工环境（全双工不需要）
- “先听后发，边听边发，冲突停发，随机重发”
- 争用期：以太网端到端往返传播时延$ 2\tau $。只有过了争用期，才能确定没有冲突

#### 流程
1. 准备发送：适配器从网络层获得一个分组，封装成帧，放入适配器缓存
2. 检测信道：若信道忙，则持续检测，直到信道空闲；若在最小帧间间隔后信道空闲，则发送帧
3. 争用期内未检测到冲突，则发送成功；若检测到冲突，立即停止发送，适配器执行退避算法，回到步骤2

#### 以太网相关
- 以太网最小帧长：小于该长度的帧被识别为无效帧
公式：$ L_{min} = 2\tau \times r $，其中，$ r $为数据传输速率
- 以太网规定**51.2微秒**为争用期，例如10Mbps以太网最小帧长为512比特（64字节）
- 以太网最大帧长：1518字节或1522字节（含VLAN标签）
- 帧间最小间隔：96比特时间

#### 截断二进制指数退避算法
1. 确定基本退避时间，一般取争用期
2. 从离散的整数集合$ \{0,1,2,...,2^k-1\} $中随机选择一个数$ r $，重传所需推迟时间
为$ 2r\tau $。参数$ k= \min(重传次数,10) $
3. 重传次数达到**16**次，放弃该帧
